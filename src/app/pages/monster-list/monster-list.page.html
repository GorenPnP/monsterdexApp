<ion-toolbar #headerExpanded style="display: flex; padding: 16px" class="header--expanded">

  <ion-note style="flex-basis: 70ch;">
    <span *ngFor="let type of allTypes">
      <ion-button shape="round" size="small" [color]="filter.types.includes(type.id) ? 'success' : 'tertiary'" (click)="toggleType(type)">
        <ion-icon [name]="type.icon"></ion-icon>
      </ion-button>
    </span>

    <ion-button *ngIf="filter.types.length > 1" fill="outline" shape="round" size="small" (click)="toggleOperator()">
      {{ filter.typeAnd ? 'UND' : 'ODER' }}
    </ion-button>
  </ion-note>

  <ion-item>
    <ion-label position="stacked">Rang-Sortierung</ion-label>

    <!-- TODO -->
    <ion-button *ngIf="filter.rankOrdering === RankOrdering.NONE" fill="outline" shape="round" size="small" (click)="sortByRank(RankOrdering.ASC)">
      keine
    </ion-button>
    <ion-button *ngIf="filter.rankOrdering === RankOrdering.ASC" fill="outline" shape="round" size="small" (click)="sortByRank(RankOrdering.DESC)">
      <ion-icon name="caret-down"></ion-icon>
    </ion-button>
    <ion-button *ngIf="filter.rankOrdering === RankOrdering.DESC" fill="outline" shape="round" size="small" (click)="sortByRank(RankOrdering.NONE)">
      <ion-icon name="caret-up"></ion-icon>
    </ion-button>

  </ion-item>
</ion-toolbar>

<ion-toolbar #headerSticky mode="md">
  <ion-buttons slot="start">
    <ion-button (click)="headerIsExpanded = !this.headerIsExpanded">
      <ion-icon [name]="headerIsExpanded ? 'caret-up' : 'caret-down'"></ion-icon>
    </ion-button>
  </ion-buttons>

  <ion-searchbar
    showCancelButton="focus"
    placeholder="Name oder Nummer"
    animated
    color="primary"
    [(ngModel)]="filter.name"
    (ionChange)="onSearchChanged()"
  >
  </ion-searchbar>

  <ion-buttons slot="end">
    <ion-button (click)="presentTypePopover($event)">
      <ion-icon name="information-circle-outline"></ion-icon>
    </ion-button>
  </ion-buttons>
</ion-toolbar>

<ion-content
  fullscreen="full"
  scrollEvents="true"
  [appScrollHeader]="headerExpanded"
  [appStickyHeader]="headerSticky">

  <ion-text *ngIf="!monsters?.length" class="ion-text-center ion-text-wrap"><h2>Hier ist nichts</h2></ion-text>

  <ion-list>
    <ion-item
      *ngFor="let monster of monsters"
      detail
      [routerLink]="['/monster-detail', monster.id]"
      routerDirection="forward"
      lines="full"
      style="--min-height: 90px;">
      
      <ion-avatar style="height: 80px; width: 80px">
        <img [src]="monster.showThumbnail" style="width: 80px; max-width: 80px;">
      </ion-avatar>
      
      <div style="display: flex; flex-direction: column; margin-top: 4px; margin-bottom: 4px; margin-left: 40px; width: 100%">
        <ion-text class="ion-text-wrap">{{ monster.name }}</ion-text>

        <div style="margin-top: 6px; margin-left: -2px;">
          <ion-button *ngFor="let type of monster.types" size="small" shape="round" color="tertiary">
            <ion-icon [name]="type.icon" slot="icon-only"></ion-icon>
          </ion-button>
        </div>
      </div>
    </ion-item>
  </ion-list>

  <ion-infinite-scroll (ionInfinite)="loadMonsters($event)" [disabled]="pageNr === -1">
    <ion-infinite-scroll-content loadingSpinner="bubbles" loadingText="Mehr sind auf dem Weg...">
    </ion-infinite-scroll-content>
  </ion-infinite-scroll>

</ion-content>
